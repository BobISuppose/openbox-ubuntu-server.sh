#!/bin/bash

set -e

echo "Updating system..."
sudo apt update && sudo apt -y upgrade

echo "Installing Xorg and Openbox..."
sudo apt install -y \
  xorg \
  openbox \
  obconf \
  tint2 \
  pcmanfm \
  xterm \
  lxappearance \
  network-manager-gnome \
  pavucontrol \
  feh \
  fonts-dejavu \
  dbus-x11

echo "Enabling NetworkManager..."
sudo systemctl enable NetworkManager
sudo systemctl start NetworkManager

echo "Creating Openbox config directories..."
mkdir -p ~/.config/openbox

echo "Setting Openbox autostart..."
cat > ~/.config/openbox/autostart << 'EOF'
# Start panel
tint2 &

# Start file manager (desktop icons)
pcmanfm --desktop &

# Network tray
nm-applet &

# Set wallpaper (solid color fallback)
feh --bg-scale /usr/share/backgrounds/* 2>/dev/null || true
EOF

echo "Creating .xinitrc..."
cat > ~/.xinitrc << 'EOF'
exec openbox-session
EOF

chmod +x ~/.xinitrc

echo "Done!"
echo
echo "➡️  Reboot or log in and run: startx"
echo "➡️  Right-click desktop for menu"
echo "➡️  Ctrl+Alt+Backspace exits X"